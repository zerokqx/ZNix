# Agent Guide

Quick map of this repo and how to work on it.

## Flake entry points
- `flake.nix` pulls inputs: nixpkgs (25.11), home-manager, nixvim, stylix, nix-flatpak, noctalia, firefox-nightly, flake-parts.
- Outputs expose NixOS configurations via `hosts/default.nix`. Target names: `desktop` and `laptop`.
- Build examples:
  - `nix build .#nixosConfigurations.desktop.config.system.build.toplevel --no-link`
  - `nix build .#nixosConfigurations.laptop.config.system.build.toplevel --no-link`

## Host structure
- `hosts/desktop/default.nix`: wraps `nixosSystem` for x86_64-linux, imports `../../configuration.nix` (base system), host hardware, `ollama.nix`, and home-manager. Home for `zerok` imports host `opencode.nix`, flatpak/stylix/noctalia/nixvim modules, and `../../home`. (Note: `configuration.nix` listed twice.)
- `hosts/laptop/default.nix`: similar but adds `fprintd.nix`, laptop-specific sway output override (font size 14, eDP layout), plus ollama/opencode.
- `hosts/*/hardware-configuration.nix`: generated by nixos-generate-config.
- `hosts/*/ollama.nix` / `opencode.nix` / `fprintd.nix`: host-specific feature toggles.

## System modules
- `configuration.nix`: top-level NixOS config importing `./core` and `./configs`, enabling swayfx, docker, polkit, gvfs/udisks2, nix flakes, gc schedule, and base programs (fish, direnv, steam/gamescope, nix-ld, etc.). `system.stateVersion = "25.05"`.
- `core/`: reusable system pieces (imports via `core/default.nix`):
  - `packages.nix`, `pipewire.nix`, `graphics.nix`, `bluetooth.nix`, `users/`, `timezone.nix`, `networking.nix`, `nixpkgs.nix`, `boot.nix`. (Pipewire listed twice in default import; currently harmless.)
- `configs/`: bundle of extra system tweaks (`throne.nix`, `zapret.nix`), loaded by `configs/default.nix`.

## Home-manager stack
- `home/default.nix`: main user config for `zerok`. Imports app/services modules (`git.nix`, `firefox.nix`, `flatpak.nix`, `zoxide.nix`, `alacritty.nix`, `fish.nix`, `sway/`, `packages.nix`, `dir-file-create.nix`, `noctalia.nix`, `stylix.nix`, `nixvim`). Sets session vars, PATH entries for cargo/bun, enables udiskie, codex, allows unfree, and home stateVersion `25.11`.
- `home/sway/`: swayfx configuration split into `assigns.nix`, `input.nix`, `output.nix`, `window-command.nix`, `startup.nix`, `keybindings.nix`, `swaylock.nix`.
- Other `home/*.nix` files are single-purpose modules for the imported programs/options.

## Nixvim layout (refactored)
- Entry: `home/nixvim/default.nix` imports `autocmds.nix`, `languages/`, `plugins/`, `keymaps.nix`, `opts.nix`.
- `home/nixvim/languages/default.nix`: manual list of language modules (css, docker, html, json, lua, markdown, nix, shell, typescript, yaml).
- `home/nixvim/plugins/default.nix`: groups:
  - `completion/` (blink with git/ripgrep/spell providers, friendly-snippets, luaship)
  - `core/` (lz-n loader, snacks core + bigfile, which-key, perfomance)
  - `editor/` (mini/* suite, autosave/session, flash, yanky, undotree, numbertoggle, autolist)
  - `ide/` (lsp, lspsaga, conform, dap + ui, fidget, goto-preview, neogen)
  - `integrations/` (lazygit, obsidian, wakatime)
  - `ui/` (treesitter, noice, trouble, bufferline, lualine, ufo, colorizer, web-dev-icons)
- No auto-import helper remains; each `default.nix` lists its modules explicitly.

## Tips for agents
- When adding modules, wire them through the relevant `default.nix` explicitly (no helper).
- Home-manager runs inside the NixOS host configs; there are no standalone `homeConfigurations` outputs.
- Use `nix fmt`/`statix` cautiously; repo may have intentional quirks (e.g., duplicate imports).
